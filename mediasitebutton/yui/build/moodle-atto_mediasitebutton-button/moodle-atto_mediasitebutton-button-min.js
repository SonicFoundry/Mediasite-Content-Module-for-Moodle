YUI.add("moodle-atto_mediasitebutton-button",function(e,t){var i,o="atto_mediasitebutton",n="",a=1024,l="",s=!1,d="atto_mediasitebutton";e.namespace("M.atto_mediasitebutton").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_lang:"en",initializer:function(t){if(this._log("Initializing atto_mediasitebutton in debug"),this._log("launch_url: "+t.launch_url),this._log("site_id: "+t.site_id),this._log("enabled: "+t.enabled),this._log("assignment launch url: "+l),t.enabled){n=this._decodeUrl(t.launch_url),t.site_id,"CustomIntegration",t.toolconsumerkey,t.newpage,t.extcontentreturnurl,l=this._decodeUrl(t.assignmentlaunchurl);var i=e.DOM.winWidth();i>0&&(a=i>900?i-120:i-40),this._log("viewPortWidth: "+i+", WIDTH: "+a),this.addButton({title:"mediasitebutton",buttonName:"mediasitebutton",icon:"icon",iconComponent:"atto_mediasitebutton",callback:this._displayMediasiteUploadDialog})}else this._log("The atto_mediasitebutton is disabled, exiting.")},_decodeUrl:function(e){return decodeURIComponent(atob(e)).replace(/&amp;/g,"&")},_displayMediasiteUploadDialog:function(e,t){this._log("_displayMediasiteUploadDialog"),i=this;var n=this.getDialogue({headerContent:M.util.get_string("dialogtitle",o),width:a+60+"px",height:"980px",focusAfterHide:t});s=!1,n.after("visibleChange",function(){!1===n.getAttrs().visible&&setTimeout(function(){n.reset()},5)}),n.set("bodyContent",this._buildMediasiteDialogContent()).show(),this._resizeDialog(),this.markUpdated()},_buildMediasiteDialogContent:function(t){var i=M.util.get_string("editor_insert",o),l=e.Handlebars.compile('<div id="{{element_id}}_div" class="mdl-align"><iframe id="{{element_id}}_iframe" src="{{launch_url}}" height="{{height}}" width="{{width}}" scrolling="auto"></iframe></div>'),s=e.Node.create(l({launch_url:n,height:800,width:a,element_id:d,insert:i}));return this._form=s,s},_resizeDialog:function(e){this._log("_resizeDialog called");this._log("iframdeid: atto_mediasitebutton_iframe")},_log:function(e){console.log(o+" : "+e)}});try{window.removeEventListener("message",r,!1)}catch(e){}function r(e){if(console.log(o+" : Atto button callback received a message!"),null!=e&&null!=e.data){try{var t=JSON.parse(e.data);if(!t.attoButtonEmbed)return;if(i.getDialogue({focusAfterHide:null}).hide(),i.editor.focus(),s)console.log(o+" : The content has already been embedded once. Skip this event.");else{var n=t.resourceId,a=l.replace("##ID##",n),d=decodeURIComponent(t.contentHtml);d=(d=(d=d.replace("REPLACE_THIS_LAUNCH_URL",a)).replace("REPLACE_THIS_LAUNCH_URL",a)).replace("REPLACE_THIS_LAUNCH_URL",a),console.log(o+" : replaced embed launch url: "+a),console.log(o+" : replaced embed content html: "+d),i.get("host").insertContentAtFocusPoint(d),s=!0}i.markUpdated()}catch(e){return void console.log(o+" : There was an error parsing the message")}console.log(o+" : Finished processing postmessage")}}window.addEventListener("message",r,!1)},"@VERSION@",{requires:["moodle-editor_atto-plugin","get"]});